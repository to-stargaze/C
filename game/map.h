#include<stdio.h>
#include<stdlib.h>
#include<time.h>
#include <conio.h>
#include<Windows.h>
#include"color.h"

char realmap[30][40];
char map1[1][30][40]=
	{
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.',
	'.','l','.','l','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.','.'
	};
/*	
void systemReset(){
	DWORD CIN;
	DWORD mode;
    CIN = GetStdHandle(STD_INPUT_HANDLE);
	GetConsoleMode(CIN, &mode);
	SetConsoleMode(CIN, mode | ENABLE_MOUSE_INPUT);
}	
*/
void gotoxy(int x,int y){
	COORD pos={x,y};
	SetConsoleCursorPosition(GetStdHandle(STD_OUTPUT_HANDLE),pos);//커서를 특정 위치로 지정  
}
void delay(clock_t n)
{
  clock_t start = clock();
  while(clock() - start < n);
}
int ani(void){
	int i,j;
	backwhite(); 
	for(i=0;i<29;i=i+4){
		for(j=0;j<40;j++){
			gotoxy(j,i);
			printf(".");
			gotoxy(j,i+1);
			printf(".");
			if(i<26){
			gotoxy(j,i+2);
			printf(".");
			gotoxy(j,i+3);
			printf(".");}
			delay(7);
		}
		printf("\n");
	}
	delay(190);
	backgray7();
	system("cls");
	delay(200);
	backgray7();
	system("cls");
	delay(200);
	backgray8();
	system("cls");
	delay(200);
	backblack();
	system("cls");
}

char getHistoryMap(int a,int x,int y){
	return map1[a][x][y];	
}

void map(int a,int x,int y,int mx[20],int my[20]){
	
	int i,j;
	for(i=0;i<30;i++)
		for(j=0;j<40;j++)
			realmap[i][j]=map1[a][i][j];
	for(i=0;i<20;i++)
	realmap[mx[i]][my[i]]='0';
	
	system("cls");  
	for(i=0;i<30;i++){
		for(j=0;j<40;j++){
			if(realmap[i][j]=='.')
			green();  
			else
			gray();
			printf("%c",realmap[i][j]);  
		}
		printf("\n");
	}
	white();
	gotoxy(y,x); 
	printf("*");
}
void movepos(int a,int hx,int hy,int x,int y,int mx[5],int my[5],char c){
	int i;
	gotoxy(y,x);
	white();
	printf("*");
	if(c=='.')  
		green(); 
	else
		gray();
	if(hx==x||hy==y)
	gotoxy(hy,hx); 
	else
	gotoxy(39,30); 
	printf("%c",c);
	gotoxy(39,30);
	for(i=0;i<20;i++)
	{
		int k=0;
		if(mx[i]==x&&my[i]==y){
			system("cls");
			white();
			ani();
			printf("전투시작\n    /w_____/w\n   /  o   o  w\n  ( ==  ^  == )\n   )         (\n  (           )\n ( (  )   (  ) )\n(__(__)___(__)__)\n");
			while(k==0)
			scanf("%d",&k);
			realmap[mx[i]][my[i]]='*';
			mx[i]=my[i]=41;
			system("cls");
			map(a,x,y,mx,my);
			gotoxy(y,x);
			printf("*");
			break;
		}
	}
}


